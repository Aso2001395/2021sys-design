```uml
@startuml
ユーザ -> webサーバ : ログイン
webサーバ -> DBサーバ : ログイン照会 
DBサーバ -> DBサーバ : ログイン処理 
DBサーバ -> webサーバ : 認証結果 

activate ユーザ 

alt 認証成功 
webサーバ -> ユーザ : ユーザ名表示 
else 認証失敗 
webサーバ -> ユーザ : 失敗メッセージ表示 
end

ユーザ -> webサーバ : 購入する
webサーバ -> ユーザ : 購入ページ表示
ユーザ -> webサーバ : 金額入力
webサーバ -> DBサーバ : 問い合わせ
DBサーバ -> DBサーバ : 支払い処理

alt 登録済
DBサーバ -> webサーバ : 支払い
webサーバ -> ユーザ : ギフトコード送信
else 未登録
DBサーバ -> webサーバ : エラー
webサーバ -> ユーザ : 登録メッセージを表示
end

ユーザ -> webサーバ : ログアウト
webサーバ -> DBサーバ : ログアウト照会 
DBサーバ -> DBサーバ : ログアウト処理 
DBサーバ -> webサーバ : 処理結果
webサーバ -> ユーザ : ログアウトメッセージ表示

deactivate ユーザ

webサーバ -> ユーザ : トップページ表示
@enduml
```
